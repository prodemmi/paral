done_msg = "All tasks finished!"

task first_task {
    -> @stash["messages"] << "Hello from stash"
    -> sleep 1
    -> @buf["messages"] << "Hello from buffer"
}

@depend first_task
task second_task {
    -> @print(@stash("messages"))
}

@wait @isnot(@buf("messages"), hich)
task third_task {
    -> @print(@buf("messages"))
}

@defer
task print_done {
    -> @print(done_msg)
}
